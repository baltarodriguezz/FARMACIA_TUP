<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Administrar Clientes - Farmacia Luz</title>
  <link rel="stylesheet" href="../assets/output.css" />
</head>
<body class="bg-gray-100 flex min-h-screen font-sans">

  <!-- ğŸ”¹ SIDEBAR -->
  <aside class="w-64 bg-[#275c74] text-white flex flex-col justify-between">
    <div>
      <div class="p-6 border-b border-white/20">
        <h2 class="text-2xl font-bold text-center">Admin Farmacia</h2>
      </div>
      <nav class="flex flex-col gap-2 p-4">
        <a href="index.html" class="py-2 px-3 rounded hover:bg-[#12b1be] transition">ğŸ  Dashboard</a>
        <a href="productos.html" class="py-2 px-3 rounded hover:bg-[#12b1be] transition">ğŸ§´ Productos</a>
        <a href="clientes.html" class="py-2 px-3 bg-[#12b1be] rounded font-semibold">ğŸ‘¥ Clientes</a>
        <a href="ventas.html" class="py-2 px-3 rounded hover:bg-[#12b1be] transition">ğŸ§¾ Ventas</a>
      </nav>
    </div>
    <div class="p-4 text-center border-t border-white/20 text-sm opacity-80">
      Â© 2025 Farmacia Luz
    </div>
  </aside>

  <!-- ğŸ”¹ CONTENIDO PRINCIPAL -->
  <main class="flex-1 p-8">

    <!-- Encabezado -->
    <div class="flex justify-between items-center mb-8">
      <h1 class="text-3xl font-bold text-[#275c74]">GestiÃ³n de Clientes</h1>
      <div class="flex gap-3">
        <button id="btnTopClientes" class="bg-[#12b1be] hover:bg-[#0e9ca9] text-white px-4 py-2 rounded-lg transition">
          ğŸ† Clientes que mÃ¡s compran
        </button>
        <button id="btnCredito" class="bg-[#275c74] hover:bg-[#1f4d60] text-white px-4 py-2 rounded-lg transition">
          ğŸ’³ Solo con tarjeta de crÃ©dito
        </button>
      </div>
    </div>

    <!-- Tabla de clientes -->
    <div class="overflow-x-auto bg-white rounded-xl shadow-md">
      <table class="min-w-full border-collapse text-sm text-left">
        <thead class="bg-[#275c74] text-white">
          <tr>
            <th class="p-3">ID</th>
            <th class="p-3">Nombre</th>
            <th class="p-3">CUIT</th>
            <th class="p-3">Obra Social</th>
            <th class="p-3">Email</th>
            <th class="p-3">TelÃ©fono</th>
            <th class="p-3">Forma de Pago</th>
            <th class="p-3">Total Compras</th>
            <th class="p-3">Acciones</th>
          </tr>
        </thead>
        <tbody id="tablaClientes" class="divide-y">
          <!-- JS genera las filas -->
        </tbody>
      </table>
    </div>

    <!-- Modal editar cliente -->
    <div id="modalCliente" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-50">
      <div class="bg-white rounded-xl p-6 w-96 shadow-xl">
        <h2 id="tituloModal" class="text-xl font-bold text-[#275c74] mb-4">Editar Cliente</h2>
        <form id="formCliente" class="flex flex-col gap-3">
          <input id="nombre" placeholder="Nombre completo" class="border rounded p-2">
          <input id="cuit" placeholder="CUIT" class="border rounded p-2">
          <input id="obraSocial" placeholder="Obra social" class="border rounded p-2">
          <input id="email" placeholder="Email" type="email" class="border rounded p-2">
          <input id="telefono" placeholder="TelÃ©fono" class="border rounded p-2">
          <select id="formaPago" class="border rounded p-2">
            <option value="">Forma de pago</option>
            <option value="Efectivo">Efectivo</option>
            <option value="Tarjeta de crÃ©dito">Tarjeta de crÃ©dito</option>
            <option value="DÃ©bito">DÃ©bito</option>
            <option value="Transferencia">Transferencia</option>
          </select>
          <div class="flex justify-end gap-2 mt-3">
            <button type="button" id="btnCancelar" class="px-4 py-2 rounded border border-gray-400 hover:bg-gray-100">Cancelar</button>
            <button type="submit" class="bg-[#12b1be] hover:bg-[#0e9ca9] text-white px-4 py-2 rounded">Guardar</button>
          </div>
        </form>
      </div>
    </div>

  </main>

  <!-- ğŸ”¹ SCRIPT -->
  <script>
    const clientes = [
      { id: 1, nombre: "Juan PÃ©rez", cuit: "20-34567890-1", obraSocial: "OSDE", email: "juanperez@mail.com", telefono: "1123456789", formaPago: "Tarjeta de crÃ©dito", totalCompras: 150000 },
      { id: 2, nombre: "MarÃ­a GÃ³mez", cuit: "27-98765432-5", obraSocial: "Swiss Medical", email: "maria@mail.com", telefono: "1145678901", formaPago: "Efectivo", totalCompras: 70000 },
      { id: 3, nombre: "LucÃ­a FernÃ¡ndez", cuit: "23-11223344-7", obraSocial: "IOMA", email: "lucia@mail.com", telefono: "1132214455", formaPago: "Tarjeta de crÃ©dito", totalCompras: 120000 },
      { id: 4, nombre: "Carlos DÃ­az", cuit: "20-99999999-9", obraSocial: "Galeno", email: "carlos@mail.com", telefono: "1188877766", formaPago: "DÃ©bito", totalCompras: 40000 }
    ];

    let clienteEditando = null;
    const tabla = document.getElementById("tablaClientes");
    const modal = document.getElementById("modalCliente");
    const form = document.getElementById("formCliente");
    const btnCancelar = document.getElementById("btnCancelar");
    const btnTopClientes = document.getElementById("btnTopClientes");
    const btnCredito = document.getElementById("btnCredito");

    // Render tabla
    function renderTabla(lista = clientes) {
      tabla.innerHTML = "";
      lista.forEach(c => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="p-3">${c.id}</td>
          <td class="p-3">${c.nombre}</td>
          <td class="p-3">${c.cuit}</td>
          <td class="p-3">${c.obraSocial}</td>
          <td class="p-3">${c.email}</td>
          <td class="p-3">${c.telefono}</td>
          <td class="p-3">${c.formaPago}</td>
          <td class="p-3 text-[#12b1be] font-semibold">$${c.totalCompras}</td>
          <td class="p-3 flex gap-2">
            <button onclick="editar(${c.id})" class="text-blue-600 hover:underline">Editar</button>
            <button onclick="eliminar(${c.id})" class="text-red-600 hover:underline">Eliminar</button>
          </td>
        `;
        tabla.appendChild(tr);
      });
    }

    renderTabla();

    // Modal handlers
    function abrirModal() {
      modal.classList.remove("hidden");
    }
    function cerrarModal() {
      modal.classList.add("hidden");
      form.reset();
      clienteEditando = null;
    }

    btnCancelar.addEventListener("click", cerrarModal);

    // Guardar cliente editado
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      if (!clienteEditando) return;

      clienteEditando.nombre = form.nombre.value;
      clienteEditando.cuit = form.cuit.value;
      clienteEditando.obraSocial = form.obraSocial.value;
      clienteEditando.email = form.email.value;
      clienteEditando.telefono = form.telefono.value;
      clienteEditando.formaPago = form.formaPago.value;

      renderTabla();
      cerrarModal();
    });

    // Funciones globales
    window.editar = (id) => {
      const cliente = clientes.find(c => c.id === id);
      if (!cliente) return;
      clienteEditando = cliente;

      form.nombre.value = cliente.nombre;
      form.cuit.value = cliente.cuit;
      form.obraSocial.value = cliente.obraSocial;
      form.email.value = cliente.email;
      form.telefono.value = cliente.telefono;
      form.formaPago.value = cliente.formaPago;

      abrirModal();
    };

    window.eliminar = (id) => {
      if (confirm("Â¿Eliminar este cliente?")) {
        const index = clientes.findIndex(c => c.id === id);
        if (index !== -1) {
          clientes.splice(index, 1);
          renderTabla();
        }
      }
    };

    // BotÃ³n "Clientes que mÃ¡s compran"
    btnTopClientes.addEventListener("click", () => {
      const top = [...clientes].sort((a, b) => b.totalCompras - a.totalCompras).slice(0, 3);
      renderTabla(top);
    });

    // BotÃ³n "Solo tarjeta de crÃ©dito"
    btnCredito.addEventListener("click", () => {
      const filtrados = clientes.filter(c => c.formaPago === "Tarjeta de crÃ©dito");
      renderTabla(filtrados);
    });
  </script>

</body>
</html>
